webpackJsonp([1],{NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("MVMM"),i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var n=a("vSla")({name:"app"},i,!1,function(e){a("iuaR")},null,null).exports,l=a("zO6J"),r={props:{src:{type:String,required:!0},canEdit:{type:Boolean,default:()=>!0},imgData:{type:Object,required:!1,default:()=>({})},multiple:{type:Boolean,default:()=>!0},change:{type:Boolean,required:!1},maxlength:{type:Number,default:()=>6},clear:{type:Boolean,required:!1,default:()=>!1}},data:()=>({files:[],isFirstLoad:!0,uploading:!1,percent:0,newUrl:""}),mounted(){this.initFiles()},methods:{clearFiles(){this.clear&&(this.files=[])},initFiles(){if("{}"!==JSON.stringify(this.imgData))for(let t in this.imgData){var e={};e.name=t,e.src=this.imgData[t]+"?x-oss-process=image/resize,w_200,h_300/quality,q_100",this.files.push(e)}this.isFirstLoad=!1},add(){this.$refs.file.click()},submit(e,t){if(console.log("图片上传中"),0===this.files.length)return void console.warn("no file!");const a=new FormData;var s=this.dataURItoBlob(this.newUrl);console.log("压缩后的图片大小》》》",s.size),a.append(e.name,s,"image.png");const i=new XMLHttpRequest;i.upload.addEventListener("progress",this.uploadProgress,!1),i.open("POST",this.src,!0),this.uploading=!0,i.send(a),i.onload=(()=>{if(this.uploading=!1,200===i.status||304===i.status){let a={},s=(new Date).getTime()+t;a[s]=JSON.parse(i.response).Data,e.name=s,this.imgData=Object.assign(this.imgData,a),this.$emit("uploadImg",this.imgData),console.log("图片上传成功！")}else console.log(`error：error code ${i.status}`)})},remove(e,t){this.files.splice(t,1),delete this.imgData[e.name],this.$emit("uploadImg",this.imgData),document.getElementsByClassName("v-modal").length&&(document.getElementsByClassName("v-modal")[0].style.display="none")},async fileChanged(){let e=this.$refs.file.files;if(this.files.length+e.length<7)for(let t=0;t<e.length;t++){const a={name:e[t].name,size:e[t].size,file:e[t]};console.log("压缩前大小》》》",e[t].size),await this.compress(e[t],a,t),this.files.push(a)}else console.log("最多选择六张图片");this.$refs.file.value=""},uploadProgress(e){const t=this;if(e.lengthComputable){const a=Math.round(100*e.loaded/e.total);t.percent=a/100}else console.warn("upload progress unable to compute")},compress(e,t,a){const s=this;var i=new FileReader;i.onload=function(e){var i=new Image;i.src=e.target.result,i.onload=function(){var e=this.naturalWidth,n=this.naturalHeight,l=e,r=n;(e>300||n>300)&&(e/n>1?(l=300,r=Math.round(n/e*300)):(r=300,l=Math.round(e/n*300)));var o=document.createElement("canvas"),c=o.getContext("2d");let d;o.width=l,o.height=r,c.clearRect(0,0,l,r),s.EXIF.getData(i,()=>{d=s.EXIF.getTag(this,"Orientation")}),6===d?(c.save(),c.translate(l/2,r/2),c.rotate(90*Math.PI/180),c.drawImage(this,0-r/2,0-l/2,r,l),c.restore()):c.drawImage(this,0,0,l,r),s.newUrl=o.toDataURL("image/jpeg"),s.$set(t,"src",s.newUrl),s.submit(t,a)}},i.readAsDataURL(e)},dataURItoBlob(e){for(var t=e.split(","),a=t[0].match(/:(.*?);/)[1],s=atob(t[1]),i=s.length,n=new Uint8Array(i);i--;)n[i]=s.charCodeAt(i);return new Blob([n],{type:a})}},watch:{change(){if(!this.isFirstLoad){for(let e=0;e<this.files.length;e++)if("selectImg"===this.files[e].name){this.files.splice(e,1);break}this.clearFiles(),this.initFiles()}}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"vue-uploader"},[a("h3",{staticClass:"file-tips"},[e._v("\n\t\t还可上传"+e._s(e.maxlength-e.files.length)+"张图片\n\t")]),e._v(" "),a("div",{staticClass:"file-list"},[e._l(e.files,function(t,s){return a("section",{key:t.src,staticClass:"file-item draggable-item"},[a("img",{attrs:{src:t.src,alt:"",ondragstart:"return false;"}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.canEdit,expression:"canEdit"}],staticClass:"file-remove",on:{click:function(a){e.remove(t,s)}}},[e._v("+")])])}),e._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:e.files.length<e.maxlength&&e.canEdit,expression:"files.length < maxlength && canEdit"}],staticClass:"file-item add-box"},[a("div",{on:{click:e.add}},[e._m(0)])])],2),e._v(" "),a("section",[a("div",{staticClass:"imgProgress-bar"},[e.uploading?a("section",{style:{width:100*e.percent+"%"}},[e._v(e._s(100*e.percent+"%"))]):e._e()])]),e._v(" "),a("input",{ref:"file",attrs:{type:"file",accept:"image/*",multiple:e.multiple},on:{change:e.fileChanged}})])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"add"},[t("span",[this._v("+")])])}]};var c=a("vSla")(r,o,!1,function(e){a("kDSH")},null,null).exports,d={name:"HelloWorld",data:()=>({canEdit:!0,multiple:!0,imgSrc:"@/components/imgBox",imgMax:6,clearImgData:!0,imgData:{},upDateImg:!1}),methods:{uploadImg(){}},components:{imgUpload:c}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"hello"},[a("h1",[e._v(" This is an image upload demo ")]),e._v(" "),a("h3",[e._v("-By wrx")]),e._v(" "),a("img-upload",{staticClass:"yourBoxCss",attrs:{canEdit:e.canEdit,imgData:e.imgData,src:e.imgSrc,multiple:e.multiple,maxlength:e.imgMax,clear:e.clearImgData,change:e.upDateImg},on:{uploadImg:e.uploadImg}})],1)},staticRenderFns:[]};var u=a("vSla")(d,m,!1,function(e){a("l+4J")},"data-v-226a4f1d",null).exports;s.a.use(l.a);var h=new l.a({routes:[{path:"/",name:"index",component:u}]}),g=a("vvLd"),p=a.n(g);s.a.config.productionTip=!1,s.a.prototype.EXIF=p.a,new s.a({el:"#app",router:h,template:"<App/>",components:{App:n}})},iuaR:function(e,t){},kDSH:function(e,t){},"l+4J":function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.0af8880266d897a0844c.js.map